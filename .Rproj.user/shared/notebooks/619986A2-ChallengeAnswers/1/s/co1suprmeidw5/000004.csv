"0","ny.nights <- daily.revenue.listings %>%"
"0","  filter(occupancy==1, blocked==0) %>%"
"0","  select(date, creation_date) %>%"
"0","  filter(day(date)==31, month(date)==12) %>%"
"0","  group_by(date, creation_date) %>%"
"0","  summarise(reservations=n()) %>%"
"0","  group_by(date) %>%"
"0","  mutate(percentage_until=cumsum(reservations)/sum(reservations),"
"0","         advance=as.numeric(creation_date-date),"
"0","         year=as.character(year(date)))"
"1","`summarise()` has grouped output by 'date'. You can override using the `.groups` argument.
"
"0","percentage.by.advance.plot <- ny.nights %>%"
"0","  ggplot(aes(x=advance, y=percentage_until)) +"
"0","  geom_line(aes(color=year)) +"
"0","  scale_x_continuous(""Days in advance"","
"0","                     limits = c(-100, 0)) +"
"0","  ylab(""Percentage of new year's nights sold"") +"
"0","  geom_hline(yintercept = 0.1) +"
"0","  geom_hline(yintercept = 0.5) +"
"0","  geom_hline(yintercept = 0.8) +"
"0","  geom_text(aes(-100, 0.1, label=""10%"", vjust = -1), data=data.frame()) +"
"0","  geom_text(aes(-100, 0.5, label=""50%"", vjust = -1), data=data.frame()) + "
"0","  geom_text(aes(-100, 0.8, label=""80%"", vjust = -1), data=data.frame())"
"0",""
"0","(percentage.by.advance.plot"
"0","+ geom_area(aes(fill=year, alpha=0.1), position=""identity""))"
"2","Warning:"
"2"," Removed 11 row(s) containing missing values (geom_path).
"
