"0","comission.earned.data <- daily.revenue.listings %>%"
"0","  filter(occupancy==1, blocked==0) %>%"
"0","  select(date, Localização, Categoria, Quartos,"
"0","         last_offered_price, revenue, Comissão) %>%"
"0","  mutate(month=month(date, label=TRUE)) %>%"
"0","  # Limits earnings data to only consolidated observations"
"0","  mutate(across(c(Localização, Categoria), ~as.factor(.))) %>%"
"0","  filter(date <= ""2022-03-15"")"
"0",""
"0",""
"0","# Temporal subsetting"
"0","train <- comission.earned.data %>%"
"0","  filter(date <= ""2022-01-31"")"
"0",""
"0","test <- comission.earned.data %>%"
"0","  filter(date > ""2022-01-31"")"
"0",""
"0",""
"0","# Linear model fitting"
"0","linear.model.price <- lm(last_offered_price ~ month + Localização "
"0","                                              + Categoria + Quartos,"
"0","                         data=train)"
"0","linear.model.revenue <- lm(revenue ~ month + Localização"
"0","                                     + Categoria + Quartos,"
"0","                           data=train)"
"0",""
"0","# XGBoost model fitting"
"0","make.matrix.from <- function(data){"
"0","  as.matrix(data %>%"
"0","    select(-c(last_offered_price, revenue, Comissão, date)) %>%"
"0","    mutate(month=factor(month, levels=levels(month), ordered=FALSE)) %>%"
"0","    dummy_cols(remove_selected_columns = TRUE)"
"0","  )"
"0","}"
"0",""
"0","train.matrix <- make.matrix.from(train)"
"0","test.matrix <- make.matrix.from(test%>%"
"0","                                  filter(Localização != ""ILC"","
"0","                                         Localização != ""JBV""))"
"0",""
"0","xgboost.model.price <- xgboost(data=train.matrix,"
"0","                               label=train$last_offered_price,"
"0","                               nrounds=20,"
"0","                               max.depth=6,"
"0","                               verbose=0)"
"0","xgboost.model.revenue <- xgboost(data=train.matrix,"
"0","                                 label=train$revenue,"
"0","                                 nrounds=20,"
"0","                                 max.depth=6,"
"0","                                 verbose=0)"
"0",""
"0",""
"0","# Assessing model accuracy"
"0","RMSE <- function(predictions, response, filter_new_factors=FALSE){"
"0","  test.set <-"
"0","    if(filter_new_factors){"
"0","    test %>%"
"0","      filter(Localização != ""ILC"","
"0","             Localização != ""JBV"")"
"0","    } else{"
"0","    test"
"0","    }"
"0","  n <- dim(test.set)[1]"
"0","  sqrt(sum((predictions - test.set[,response])^2)/n)"
"0","}"
"0",""
"0","## Price"
"0","mean.predictions <- rep(mean(train$last_offered_price),  #Baseline"
"0","                        length(test$last_offered_price))"
"0","linear.predictions <- predict(linear.model.price,"
"0","                              test %>%"
"0","                                filter(Localização != ""ILC"","
"0","                                       Localização != ""JBV""))"
"0","xgboost.predictions <- predict(xgboost.model.price, test.matrix)"
"0",""
"0","RMSE(mean.predictions, ""last_offered_price"")    # 352.3382"
"1","[1]"
"1"," 352.3382"
"1","
"
"0","RMSE(linear.predictions, ""last_offered_price"",  # 260.2715"
"0","     filter_new_factors = TRUE)  "
"1","[1]"
"1"," 260.2715"
"1","
"
"0","RMSE(xgboost.predictions, ""last_offered_price"", # 239.7306"
"0","     filter_new_factors = TRUE)"
"1","[1]"
"1"," 239.7306"
"1","
"
"0","## Revenue"
"0","mean.predictions <- rep(mean(train$revenue),  #Baseline"
"0","                        length(test$revenue))"
"0","linear.predictions <- predict(linear.model.revenue,"
"0","                              test %>%"
"0","                                filter(Localização != ""ILC"","
"0","                                       Localização != ""JBV""))"
"0","xgboost.predictions <- predict(xgboost.model.revenue, test.matrix)"
"0",""
"0","RMSE(mean.predictions, ""revenue"")    # 351.9307"
"1","[1]"
"1"," 351.9307"
"1","
"
"0","RMSE(linear.predictions, ""revenue"",  # 260.7388"
"0","     filter_new_factors = TRUE)  "
"1","[1]"
"1"," 260.7388"
"1","
"
"0","RMSE(xgboost.predictions, ""revenue"", # 239.9097"
"0","     filter_new_factors = TRUE)"
"1","[1]"
"1"," 239.9097"
"1","
"
