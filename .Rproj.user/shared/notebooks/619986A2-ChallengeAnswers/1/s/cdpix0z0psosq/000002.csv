"0","dynamic_harmonic_regression <- function(K, log_transform=FALSE){"
"0","  K_weekly <- if (K > 3) {3} else {K}"
"0","  "
"0","  if(log_transform){"
"0","    ARIMA(log(count) ~ PDQ(0, 0, 0)"
"0","                       + fourier(K=K_weekly, period=7)"
"0","                       + fourier(K=K, period=365.25)"
"0","                       + is.workday)"
"0","  } else{"
"0","    ARIMA(count ~ PDQ(0, 0, 0)"
"0","                  + fourier(K=K_weekly, period=7)"
"0","                  + fourier(K=K, period=365.25)"
"0","                  + is.workday)"
"0","  }"
"0","}"
"0",""
"0","reservations.daily <- daily.revenue.listings %>%"
"0","  filter(date <= ""2022-03-15"", occupancy==1, blocked==0) %>%"
"0","  select(date) %>%"
"0","  group_by(date) %>%"
"0","  summarise(count=n()) %>%"
"0","  tsibble(index=date) %>%"
"0","  fill_gaps(count=0, .full=TRUE) %>%"
"0","  mutate(is.workday = !(timeDate::isWeekend(date)"
"0","                        | (date %in% holidaysANBIMA)))"
"0",""
"0","reservations.daily.COVID.excluded <- reservations.daily %>%"
"0","  filter_index(""2021-01-01"" ~ ""2022-03-15"")"
"0",""
"0","reservations.daily.COVID.excluded.new.data <- reservations.daily.COVID.excluded %>%"
"0","  new_data(291L) %>% # predictions until 31-12-2022"
"0","  mutate(is.workday = !(timeDate::isWeekend(date)"
"0","                        | (date %in% holidaysANBIMA)))"
"0",""
"0","# Model training may take a little while"
"0","final.model <- reservations.daily.COVID.excluded %>%"
"0","  model(dynamic_harmonic_regression(K=75, log_transform=TRUE))"
"0",""
"0","demand.forecast.plot <- final.model %>%"
"0","  forecast(reservations.daily.COVID.excluded.new.data) %>%"
"0","  autoplot(reservations.daily.COVID.excluded, level=80) +"
"0","  labs(""Daily Number of Reservations Forecast"","
"0","       x=""Day"","
"0","       y=""Reservations (log scale)"") +"
"0","  scale_y_log10()"
